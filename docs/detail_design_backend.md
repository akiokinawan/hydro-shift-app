# 畑の水かけ当番可視化アプリ API詳細設計

---

## 1. GET /api/schedules?field_id=1&month=2024-06
- **概要**: 指定畑・月の当番スケジュール一覧を取得
- **リクエストパラメータ**
  - field_id: int（必須）
  - month: YYYY-MM（必須）
- **レスポンス例**
  ```json
  [
    {
      "id": 10,
      "field_id": 1,
      "date": "2024-06-10",
      "user": {
        "id": 2,
        "name": "佐藤花子"
      },
      "status": "未実施",
      "comment": ""
    }
  ]
  ```
- **処理概要**
  1. パラメータで該当スケジュールをDBから検索
  2. ユーザー情報をJOINして返却

---

## 2. POST /api/histories
- **概要**: 水かけ実施記録を登録
- **リクエスト例**
  ```json
  {
    "schedule_id": 10,
    "user_id": 2,
    "executed_at": "2024-06-10T08:00:00+09:00",
    "comment": "水かけ完了"
  }
  ```
- **レスポンス例**
  ```json
  {
    "id": 100,
    "schedule_id": 10,
    "user_id": 2,
    "executed_at": "2024-06-10T08:00:00+09:00",
    "comment": "水かけ完了"
  }
  ```
- **処理概要**
  1. リクエスト内容をDBにINSERT
  2. 登録内容を返却

---

## 3. GET /api/weather?field_id=1&date=2024-06-10
- **概要**: 指定畑・日付の天気・降雨量取得
- **リクエストパラメータ**
  - field_id: int（必須）
  - date: YYYY-MM-DD（必須）
- **レスポンス例**
  ```json
  {
    "date": "2024-06-10",
    "weather": "晴れ",
    "rain_mm": 0.0
  }
  ```
- **処理概要**
  1. 畑情報から位置情報を取得
  2. 外部天気APIを呼び出し、該当日の天気・降雨量を取得
  3. 整形して返却

---

## 4. 主要処理フロー例

### 水かけ当番の「水かけ不要」判定
1. ダッシュボード表示時、当日の天気APIを呼び出し
2. 降雨量がしきい値（例：3mm）以上なら「水かけ不要」と判定
3. それ以外は「水かけ必要」と判定

---

この設計をもとにバックエンド実装を進めてください。 